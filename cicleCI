version: 2.1

jobs:
  build:
    docker:
      - image: circleci/arduino:1.8.13 # choose the version of the Arduino Docker image that you want to use
    environment:
      ARDUINO_DIR: /usr/share/arduino
      ARDMK_DIR: /usr/local/arduino-makefile
      ARDMK_VENDOR: arduino
      BOARD_TAG: uno # replace with the board you are using
      BOARD_SUB: atmega328p # replace with the sub-model of the board you are using
      MONITOR_PORT: /dev/ttyACM0 # replace with the serial port of the Arduino device
    steps:
      - checkout # checkout the code from GitHub
      - run:
          name: Install Arduino Makefile
          command: |
            git clone https://github.com/sudar/Arduino-Makefile.git $HOME/Arduino-Makefile
            cd $HOME/Arduino-Makefile
            git checkout 1.6.0
      - run:
          name: Build and Upload Sketch
          command: make upload

workflows:
  version: 2
  build:
    jobs:
      - build:
          filters:
            branches:
              only: your-branch-name # replace with the name of the branch you want to test
